---
import { getEntry } from 'astro:content';

const general = await getEntry('general', 'general');
if (!general) throw new Error('General content not found');
const { name, logo } = general!.data;

const links = [
  { text: "Home", href: "/" },
  { text: "Products", href: "/products" },
  { text: "Contact", href: "/#contact" },
];
---

<header class="h-16 bg-white shadow-sm sticky top-0 z-[100]">
  <div class="h-full flex items-center justify-between relative container mx-auto px-6">
    <a href="/" class="z-[101]">
      <img src={logo} alt={name} class="h-18" />
    </a>
    <button class="md:hidden p-2 text-gray-900 z-[102] menu-toggle" aria-label="Toggle navigation" aria-expanded="false">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg>
    </button>
    <nav class="nav hidden md:block absolute md:static top-full left-0 w-full md:w-auto bg-white md:bg-transparent shadow-md md:shadow-none clip-path-inset-0 transition-all duration-300 md:clip-path-none">
      <ul class="flex flex-col md:flex-row gap-0 md:gap-8 items-stretch md:items-center list-none">
        {links.map(link => (
          <li><a href={link.href} class="block md:inline-block py-4 px-6 md:p-0 border-b border-gray-200 md:border-none font-medium text-[0.95rem] hover:text-[var(--color-primary)] hover:bg-gray-50 md:hover:bg-transparent transition-colors duration-200">{link.text}</a></li>
        ))}
      </ul>
    </nav>
  </div>
</header>

<script>
  const menuToggle = document.querySelector('.menu-toggle');
  const nav = document.querySelector('.nav');

  if (menuToggle && nav) {
    menuToggle.addEventListener('click', () => {
      const isExpanded = menuToggle.getAttribute('aria-expanded') === 'true';
      menuToggle.setAttribute('aria-expanded', !isExpanded);
      nav.classList.toggle('hidden');
      nav.classList.toggle('block');
    });

    // Close menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!nav.contains(e.target as Node) && !menuToggle.contains(e.target as Node) && !nav.classList.contains('hidden')) {
             if (window.innerWidth < 768) { // Only on mobile
                nav.classList.add('hidden');
                nav.classList.remove('block');
                menuToggle.setAttribute('aria-expanded', 'false');
             }
        }
    });
    
    // Close menu when clicking a link
    nav.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
            if (window.innerWidth < 768) {
                nav.classList.add('hidden');
                nav.classList.remove('block');
                menuToggle.setAttribute('aria-expanded', 'false');
            }
        });
    });
  }
</script>
